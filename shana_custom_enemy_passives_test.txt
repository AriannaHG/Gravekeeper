[SupportAbility] --todo add vfx to debuff - refer to rupture but turn it black and green maybe
ID=shana_festering_fulcrum;
name=Festering Fulcrum;
icon=icon_festering_fulcrum;
tooltip=When the bearer of this ability dies, all allies are stunned for <icon=time>30. <n>If none remain, all allies lose their <icon=PhysDef> <icon=MagDef> and will lose a third of their maximum <icon=HP> at the end of each of their turns, rounded up.;

----------------------------------------------------------------------------------------------------Define Unsustainable status effect (not visible to player by design since lasts for rest of battle more or less)

[FormulaGlobal] ID=shana_unsustainablehp;
formula=t:HPMax * 0.34; --yes, the description is a filthy liar but it's in the player's favor lmao

[FormulaGlobal] ID=shana_ceilingunsustainablehp;
formula=ceiling:d:shana_unsustainablehp * -1;

[ActorValue]
ID=shana_unsustainable_status;
name=Unsustainable;
--icon=<icon=icon_gravekeeper_rot>;
--bubbleIcon=icon_rot;
removedByNegativeMagnitude=true;
--description=;
defaultValue = 0; AIValue = 1;
minimum=0;
harmfulMagnitude = 1;
--bonusesMultiplier = 1;
animationOnHarmful = pain;
affectsActors = true;
canAffectIncapped = false;
showDamageNumbers = false;
showDamageNumbersMagnitude = false;
showDamageNumbersSign = false;
showDamageNumbersIcon = false;
showDamageNumbersElements = false;
showDamageNumbersIconInTooltips = false;
damageNumberColor_Positive = White;
damageNumberColor_Negative = White;
actorPaletteOverride =;
actorPaletteOverrideDuration = 0.27;
elementReactionModifiesDuration = false;
canBeRemovedByNonspecificAVEffectRemoval = false;
recordInActorData = true;
showEvaluationInfo = false;
allowDecimalValues = false;
percentage = false;
XPCostBase = 0;
XPCostIncrement = 0;
XPCostMultiplier = 1;
XPCostFloorToNearest = 0;

--[ActorValueReaction] this isn't visible to the player
--ID=shana_unsustainable_status; element=ruinTouch; damageMultiplier=1.34;

[ActorValueReaction]
ID=shana_unsustainable_status; element=endTurn;
action=shana_unsustainable_status_act;

[Action] ID=shana_unsustainable_status_act;
	special=usableEvenWhenCantAct;
	special=usableEvenWhenReacting;
	special=usableEvenWhenYourTurn;
[ActionAoE]
	ID=shana_unsustainable_status_act;
	cloneFrom=oneTile;
[AvAffecter] --lose 34% hp rounded up
	ID=shana_unsustainable_status_act;
	actorValue=HP;
	visibleEvaluations=true;
	visibleMiss=false;
	harmful=true;
	magnitude=d:shana_ceilingunsustainablehp;
	duration=-2;
	chance=100;
	element=HPbased;
[AvAffecterAoE]
	ID=shana_unsustainable_status_act;
	cloneFrom=oneTile;

-------------------------------------------------------------------------------------------------------Define actor value that just shows you have Festering Fulcrum equipped

[ActorValue] --------------------------------------------------------------- define shana_festering_fulcrum_equipped AV
ID=shana_festering_fulcrum_equipped;
name=Festering Fulcrum Equipped (this should not be visible);
icon=;
bubbleIcon=;

defaultValue = 0; AIValue = 0;
harmfulMagnitude = 0;
affectsActors = true;
canAffectIncapped = true;
showDamageNumbers = false;
showDamageNumbersMagnitude = false;
showDamageNumbersSign = false;
showDamageNumbersIcon = false;
showDamageNumbersElements = false;
showDamageNumbersIconInTooltips = false;
damageNumberColor_Positive = Green;
damageNumberColor_Negative = Green;
actorPaletteOverride =;
actorPaletteOverrideDuration = 0;
elementReactionModifiesDuration = false;
canBeRemovedByNonspecificAVEffectRemoval = false;
recordInActorData = true;
showEvaluationInfo = false;
allowDecimalValues = false;
percentage = false;
XPCostBase = 0;
XPCostIncrement = 0;
XPCostMultiplier = 1;
XPCostFloorToNearest = 0;

-------------------------------------------------------------------------------------------------------We return to your regularly scheduled Festering Fulcrum.
[SupportAbilityEffect]
ID=shana_festering_fulcrum;
actorValue=shana_festering_fulcrum_equipped; magnitude=1; duration=-1;

[SupportAbilityReaction]
ID=shana_festering_fulcrum; element=incapacitated; action=shana_festering_fulcrum_act; --allActors_nonIncapped or shape=17

[GlobalAoE] -- so the below works, shape 17 is all non incapped units
    ID=shana_allActors_nonIncapped; cloneFrom=allActors; shape=17;

[FormulaGlobal] ID=shana_fulcrums_remaining; --You can use allWithinAoEofCaster:shana_allActors_nonIncapped:shana_festering_fulcrum_equipped to return the total of shana_festering_fulcrum_equipped on all Actors within the shana_allActors_nonIncapped global AoE.
    formula=allWithinAoEofCaster:shana_allActors_nonIncapped:shana_festering_fulcrum_equipped;

[FormulaGlobal] ID=shana_no_fulcrums_remaining;
    formula=2-d:shana_fulcrums_remaining; --this is 2 instead of 1 due to the formula not updating in a timely manner

[Action] ID=shana_festering_fulcrum_act;
	special=usableWithoutACaster;
	special=usableEvenWhenCantAct;
	special=usableEvenWhenReacting;
	special=usableEvenWhenYourTurn;
[ActionAoE]
	ID=shana_festering_fulcrum_act;
	cloneFrom=oneTile;

[AvAffecter]
    ID=shana_festering_fulcrum_act; --stun
    visibleMiss=true; visibleEvaluations=true; harmful=true;
    actorValue=stun;
    magnitude=1;
    duration=30;
    chance=100;
[AvAffecterAoE]
    ID=shana_festering_fulcrum_act;
    shape=17;
    arc=true;
    airborne=true;
    needsLoE=false;
    needsLoS=false;
    bypassAll=true;
    canSelectAllies=true;
    canSelectEnemies=false;
    minRange=0;
    maxRange=99;

[AvAffecter]
    ID=shana_festering_fulcrum_act; --Remove Phys Def for 47 turns or ticks out of combat, in case this somehow triggers on player party.
    visibleMiss=false; visibleEvaluations=false;
    actorValue=PhysDef;
    magnitude=-t:PhysDef;
    duration=-50;
    chance=100;
[AvAffecterAoE]
    ID=shana_festering_fulcrum_act;
    shape=17;
    arc=true;
    airborne=true;
    needsLoE=false;
    needsLoS=false;
    bypassAll=true;
    canSelectAllies=true;
    canSelectEnemies=false;
    fReq=d:shana_no_fulcrums_remaining;
    minRange=0;
    maxRange=99;

[AvAffecter]
    ID=shana_festering_fulcrum_act; --Remove Mag Def for 47 turns or ticks out of combat, in case this somehow triggers on player party.
    visibleMiss=false; visibleEvaluations=false;
    actorValue=MagDef;
    magnitude=-t:MagDef;
    duration=-50;
    chance=100;
[AvAffecterAoE]
    ID=shana_festering_fulcrum_act;
    shape=17;
    arc=true;
    airborne=true;
    needsLoE=false;
    needsLoS=false;
    bypassAll=true;
    canSelectAllies=true;
    canSelectEnemies=false;
    fReq=d:shana_no_fulcrums_remaining;
    minRange=0;
    maxRange=99;

[AvAffecter]
    ID=shana_festering_fulcrum_act; --inflict Unsustainable (34% hp damage per turn, rounded up) for 47 turns or ticks out of combat, in case this somehow triggers on player party.
    visibleMiss=false; visibleEvaluations=false;
    actorValue=shana_unsustainable_status;
    magnitude=1;
    duration=-50;
    chance=100;
[AvAffecterAoE]
    ID=shana_festering_fulcrum_act;
    shape=17;
    arc=true;
    airborne=true;
    needsLoE=false;
    needsLoS=false;
    bypassAll=true;
    canSelectAllies=true;
    canSelectEnemies=false;
    fReq=d:shana_no_fulcrums_remaining;
    minRange=0;
    maxRange=99;



[SupportAbility]
ID=shana_instability;
name=Unstable Essence;
icon=icon_unstable_essence;
tooltip=You will be interrupted and silenced for <icon=time>30 when hit by physical damage. <n=>If this occurs, the resulting backlash pushes and inflicts Ruin damage equal to twice your <icon=skill_Ruin> to all adjacent, and the effects of this passive are disabled for 120 <icon=time>.;

----------------------------------------------------------------Dampened Essence AV
[ActorValue]
ID=shana_dampened_essence;
name=Dampened Essence;
icon=Dampened Essence;
bubbleIcon=;
removedByNegativeMagnitude=true;
minimum=0;
maximum=1;
harmfulMagnitude = -1;
--description=;
defaultValue = 0; AIValue = 1;
affectsActors = true;
canAffectIncapped = true;
showDamageNumbers = true;
showDamageNumbersMagnitude = false;
showDamageNumbersSign = false;
showDamageNumbersIcon = true;
showDamageNumbersElements = true;
showDamageNumbersIconInTooltips = true;
damageNumberColor_Positive = Black;
damageNumberColor_Negative = Black;
actorPaletteOverride =;
actorPaletteOverrideDuration = 0.27;
elementReactionModifiesDuration = false;
canBeRemovedByNonspecificAVEffectRemoval = false;
recordInActorData = true;
showEvaluationInfo = true;
allowDecimalValues = false;
percentage = false;
XPCostBase = 0;
XPCostIncrement = 0;
XPCostMultiplier = 1;
XPCostFloorToNearest = 0;


[SupportAbilityReaction]
ID=shana_instability; element=physical; actorValue=HP; action=shana_instability_act;

[Action] ID=shana_instability_act;
	special=usableEvenWhenCantAct;
	special=usableEvenWhenReacting;
	special=usableEvenWhenYourTurn;
	fReq=1 - c:shana_dampened_essence;
[ActionAoE]
	ID=shana_instability_act;
	cloneFrom=oneTile;
	canSelectStackedActors=true;

[AvAffecter] --dampened essence
	ID=shana_instability_act;
	visibleMiss=false;
	actorValue=shana_dampened_essence;
	harmful=false;
	magnitude=1;
	chance=100;
	duration=120;
	FXOnTile=tileLine_overlap;
	FXOnTileColor=Black;
	FXOnTile=DramaticNyeaow;
    FXOnTileColor=Black;
	FXOnTile=whiteExplosionSmall_rand_overlap;
    FXOnTileColor=Black;
	FXOnTile=smallShakeHoriz;
[AvAffecterAoE]
	ID=shana_instability_act;
	cloneFrom=oneTile;

[AvAffecter] --do ruin damage to adjacent
	ID=shana_instability_act;
	actorValue=HP;
	visibleEvaluations=true;
	visibleMiss=false;
	harmful=true;
	magnitude=-c:skill_Ruin * 2;
	duration=-2;
	chance=100;
	element=ruin;
	FXOnTile=upwardLines_quick_noOverlap;
    FXOnTileColor=Black;
	FXOnTile=ping_noOverlap;
    FXOnTileColor=Black;
	FXOnHit=largePing;
    FXOnHitColor=Green;
	FXOnHit=click;
[AvAffecterAoE]
	ID=shana_instability_act;
	cloneFrom=adjacent;

[AvAffecter] --push adjacent
	ID=shana_instability_act;
	actorValue=push;
	magnitude=1;
	duration=-2;
	chance=100;
[AvAffecterAoE]
	ID=shana_instability_act;
	cloneFrom=adjacent;

[AvAffecter] --interrupt self
	ID=shana_instability_act;
	visibleMiss = false;
	actorValue=cancel;
	magnitude=1;
	chance=100;
	duration=-2;
	FXOnHit=egg_fade;
    FXOnHitColor=Black;
[AvAffecterAoE]
	ID=shana_instability_act;
	cloneFrom=oneTile;

[AvAffecter] --silence
	ID=shana_instability_act;
	actorValue=silence;
	visibleMiss=false;
	magnitude=1;
	duration=30;
	chance=100;
[AvAffecterAoE]
	ID=shana_instability_act;
	cloneFrom=oneTile;

[SupportAbility]
ID=shana_uber_instability;
name=Very Unstable Essence;
icon=icon_unstabler_essence;
tooltip=You will be interrupted and silenced for <icon=time>30 when hit by physical damage. <n=>If this occurs, the resulting backlash pushes and inflicts Ruin damage equal to twice your <icon=skill_Ruin> to all adjacent.;

[SupportAbilityReaction]
ID=shana_uber_instability; element=physical; actorValue=HP; action=shana_uber_instability_act;

[Action] ID=shana_uber_instability_act;
	special=usableEvenWhenCantAct;
	special=usableEvenWhenReacting;
	special=usableEvenWhenYourTurn;
[ActionAoE]
	ID=shana_uber_instability_act;
	cloneFrom=oneTile;
	canSelectStackedActors=true;

[AvAffecter] --sfx only, no cd
	ID=shana_uber_instability_act;
	visibleMiss=false;
--	FXOnTile=tileLine_overlap;
--	FXOnTileColor=Black;
--	FXOnTile=DramaticNyeaow;
--      FXOnTileColor=Black;
--	FXOnTile=whiteExplosionSmall_rand_overlap;
--      FXOnTileColor=Black;
	FXOnTile=smallShakeHoriz;
[AvAffecterAoE]
	ID=shana_uber_instability_act;
	cloneFrom=oneTile;

[AvAffecter] --do ruin damage to adjacent
	ID=shana_uber_instability_act;
	actorValue=HP;
	visibleEvaluations=true;
	visibleMiss=false;
	harmful=true;
	magnitude=-c:skill_Ruin * 2;
	duration=-2;
	chance=100;
	element=ruin;
	FXOnTile=upwardLines_quick_noOverlap;
    FXOnTileColor=Black;
	FXOnTile=ping_noOverlap;
    FXOnTileColor=Black;
	FXOnHit=largePing;
    FXOnHitColor=Green;
	FXOnHit=click;
[AvAffecterAoE]
	ID=shana_uber_instability_act;
	cloneFrom=adjacent;

[AvAffecter] --push adjacent
	ID=shana_uber_instability_act;
	actorValue=push;
	magnitude=1;
	duration=-2;
	chance=100;
[AvAffecterAoE]
	ID=shana_uber_instability_act;
	cloneFrom=adjacent;

[AvAffecter] --interrupt self
	ID=shana_uber_instability_act;
	visibleMiss = false;
	actorValue=cancel;
	magnitude=1;
	chance=100;
	duration=-2;
	FXOnHit=egg_fade;
    FXOnHitColor=Black;
[AvAffecterAoE]
	ID=shana_uber_instability_act;
	cloneFrom=oneTile;

[AvAffecter] --silence
	ID=shana_uber_instability_act;
	actorValue=silence;
	visibleMiss=false;
	magnitude=1;
	duration=30;
	chance=100;
[AvAffecterAoE]
	ID=shana_uber_instability_act;
	cloneFrom=oneTile;

[SupportAbility]
ID=shana_critical_autolyze;
name=Critical Bequeath;
icon=icon_critical_autolyze;
tooltip=If you are hit into critical condition (25% <icon=HP> or below), grant all allies a stacking +6 <icon=PhysAtk><icon=skill_Ruin> for <icon=time>30.;

[SupportAbilityReaction]
ID=shana_critical_autolyze; element=physical; element=magic; actorValues=HP; action=shana_critical_autolyze_act;

[Action] ID=shana_critical_autolyze_act;
	name=Critical Autolyze;
	icon=icon_critical_autolyze;
	special=usableEvenWhenReacting;
	special=usableEvenWhenYourTurn;
[ActionAoE]
	ID=shana_critical_autolyze_act;
	cloneFrom=oneTile;
	canSelectStackedActors=true;
[AvAffecter]
	ID=shana_critical_autolyze_act;
	actorValue=allowReuseThisTurn;
	visibleMiss=false;
	harmful=false;
	magnitude=criticalSpeed_act;
	duration=-2;
	chance=100 - 100 * m:cCritical - 100 * m:incapped;
	affectGlobalAvAffecterInfo=false;
[AvAffecterAoE]
	ID=shana_critical_autolyze_act;
	cloneFrom=oneTile;
[AvAffecter]
	ID=shana_critical_autolyze_act;
	actorValue=skill_Ruin;
	visibleEvaluations=true;
	visibleMiss=false;
	harmful=false;
	chance=100 * m:tCritical;
	FXOnHit=shana_Fast_superduperSparkles;
    FXOnHitColor=Black;
    FXOnHit=shana_Fast_superduperSparkles;
    FXOnHitColor=Green;
    FXOnHit=sfx_crystallize_echo;
[AvAffecterAoE]
	ID=shana_critical_autolyze_act;
	cloneFrom=oneTile;
[AvAffecter] --6 phys
	ID=shana_critical_autolyze_act;
	actorValue=PhysAtk;
	visibleEvaluations=true;
	visibleMiss=false;
	harmful=false;
	magnitude=6 + tFromSource:PhysAtk:shana_critical_autolyze_act; --stack
	duration=30;
	chance=100 * thisPreviousAVHit:shana_critical_autolyze_act;
	FXOnHit=sparkles;
	FXOnHitColor=Black;
	FXOnHit=sparkles;
	FXOnHitColor=Green;
[AvAffecterAoE]
	ID=shana_critical_autolyze_act;
	cloneFrom=allAllies;
[AvAffecter] --6 ruin
	ID=shana_critical_autolyze_act;
	actorValue=skill_Ruin;
	visibleEvaluations=true;
	visibleMiss=false;
	harmful=false;
	magnitude=6 + tFromSource:skill_Ruin:shana_critical_autolyze_act;
	duration=30;
	chance=100 * thisPreviousAVHit:shana_critical_autolyze_act;
[AvAffecterAoE]
	ID=shana_critical_autolyze_act;
	cloneFrom=allAllies;

--[FormulaGlobal] ID=shana_autolyzehp;
--formula=t:HPMax * 0.05;

--[FormulaGlobal] ID=shana_positiveceilingautolyzehp;
--formula=ceiling:d:shana_autolyzehp;

--[FormulaGlobal] ID=shana_ceilingautolyzehp;
--formula=-d:shana_positiveceilingautolyzehp;

--[AvAffecter] --lose 5% hp rounded up
--	ID=shana_critical_autolyze_act;
--	actorValue=HP;
--	visibleEvaluations=true;
--	visibleMiss=false;
--	harmful=true;
--	magnitude=d:shana_ceilingautolyzehp;
--	duration=-2;
--	chance=100 * thisPreviousAVHit:shana_critical_autolyze_act;
--	element=HPbased;
--[AvAffecterAoE]
--	ID=shana_critical_autolyze_act;
--	cloneFrom=oneTile;


------------------------------------------------------------------------OLD BARROW ENDBOSS PASSIVES



[SupportAbility] ID=shana_hatredbeyondmeasure;
name=Hatred Beyond Measure;
tooltip=Gain immunity to casting interruption, most incapacitating effects, Domino and Dispel. If any number of effects have bypassed this immunity, inflict 13<icon=skill_Ice> damage to all enemies for each time this has occurred, then cure all negative effects on self. Furthermore, effects based off your maximum <icon=HP> are 2% as effective on you.; --todo once released, if recieve feedback that this is too obtuse, rewrite to hint more maybe?
icon=iconP_Sa_pureMind; --todo art
XPCostUnlock=80;
[SupportAbilityReaction] --interruption immunity
ID=shana_hatredbeyondmeasure; actorValues=dispel; actorValues=charging; actorValues=casting; actorValues=cancel; damageMultiplier=0;
[SupportAbilityReaction] --incap effect immunity
ID=shana_hatredbeyondmeasure; actorValues=pd_domino; actorValues=disable; actorValues=immob; actorValues=stun; actorValues=sleep; actorValues=frozen; damageMultiplier=0;
[SupportAbilityReaction] --hpbased resistance
ID=shana_hatredbeyondmeasure; element=HPbased; damageMultiplier=0.02;


[SupportAbilityReaction] --hopefully detects infliction of incapacitating status effects (transfer) and reacts accordingly
ID=shana_hatredbeyondmeasure; actorValues=transfer; actorValues=pd_domino; actorValues=disable; actorValues=immob; actorValues=stun; actorValues=sleep; actorValues=frozen; action=shana_hatredbeyondmeasure_reaction;
--ID=shana_hatredbeyondmeasure; element=any; action=shana_hatredbeyondmeasure_reaction;


[SupportAbilityReaction] --this detects when the custom element is pulsed and increases hatred stacks by 1.
ID=shana_hatredbeyondmeasure; element=42000; action=shana_hatredbeyondmeasure_increasehatred;

--to test case where multiple debilitating actor values are transferred at once (expected: one proc), and test case where a debilitating actor value is transferred multiple times in the same action (hopefully 1 proc but im ok with multiple procs).
--todo: rewrite rules text depending on interaction

[ActorValue] --------------------------------------------------------------- define AV tracking how much hatred has been built
ID=shana_hatredstacks;
name=Hatred Stacks (this should not be visible);
icon=;
bubbleIcon=;

defaultValue = 0; AIValue = 0;
harmfulMagnitude = 0;
affectsActors = true;
canAffectIncapped = false;
showDamageNumbers = true; --to change
showDamageNumbersMagnitude = false;
showDamageNumbersSign = false;
showDamageNumbersIcon = false;
showDamageNumbersElements = false;
showDamageNumbersIconInTooltips = false;
damageNumberColor_Positive = Green;
damageNumberColor_Negative = Green;
actorPaletteOverride =;
actorPaletteOverrideDuration = 0;
elementReactionModifiesDuration = false;
canBeRemovedByNonspecificAVEffectRemoval = false;
recordInActorData = true;
showEvaluationInfo = true; --to change
allowDecimalValues = false;
percentage = false;
XPCostBase = 0;
XPCostIncrement = 0;
XPCostMultiplier = 1;
XPCostFloorToNearest = 0;

[ActorValueReaction]
ID=shana_hatredstacks; actorValues=shana_hatredstacks; newID=shana_hatredstacks;

--[ActorValueReaction] -----------------------------------------------------------------------------------------------------------------------garbage collection
--ID=shana_hatredstacks;
--element=combatEnd; newID=X;

[Action] ID=shana_hatredbeyondmeasure_reaction;
	name=Hatred Beyond Measure;
	icon=iconP_Sa_pureMind; --todo art
	tooltip=Deals ramping ice damage to all enemies and cures incapacitating effects on self.;
	harmful=true;
	attractAttention=false;
	XPCost=70;
	maxRank=1;
--	casterAnimation=charge_alt;
-- 	FXOnTarget=sparkle;
-- 	FXOnTarget=briefAuraSound;
    special=usableEvenWhenCantAct;
--	special=usableEvenWhenReacting;
	special=usableEvenWhenYourTurn;
[ActionAoE]
	ID=shana_hatredbeyondmeasure_reaction;
	cloneFrom=oneTile;

[AvAffecter] ----------------------------------Dummy AV to play vfx if it goes off.
	ID=shana_hatredbeyondmeasure_reaction;
	harmful=false;
	chance=100 * c:pd_domino + 100 * c:disable + 100 * c:immob + 100 * c:stun + 100 * c:sleep + 100 * c:frozen;
	FXOnTile=sparkle;
    FXOnTile=briefAuraSound;
--	FXOnHit=briefAuraSound;
[AvAffecterAoE]
	ID=shana_hatredbeyondmeasure_reaction;
	cloneFrom=oneTile;
[AvAffecter] ----------------------------------Ice Damage.
	ID=shana_hatredbeyondmeasure_reaction;
	harmful=true;
	actorValue=HP;
	visibleMiss=false;
	magnitude=-13 - 13 * c:shana_hatredstacks;
	duration=-2;
	chance=100;
	fReq=100 * c:pd_domino + 100 * c:disable + 100 * c:immob + 100 * c:stun + 100 * c:sleep + 100 * c:frozen;
	element=ice;
[AvAffecterAoE]
	ID=shana_hatredbeyondmeasure_reaction;
	shape=7;
	maxRange=100;
	airborne=true;
	arc=true;
	bypassAll=true;
	occupyAll=true;
	canSelectAllies=false;
	canSelectEnemies=true;
[AvAffecter] --------------------------------Pulse my custom element to increase hatred stacks.
	ID=shana_hatredbeyondmeasure_reaction;
	harmful=false;
	element=42000; --actual is 42000
	chance=100;
	fReq=100 * c:pd_domino + 100 * c:disable + 100 * c:immob + 100 * c:stun + 100 * c:sleep + 100 * c:frozen;
[AvAffecterAoE]
	ID=shana_hatredbeyondmeasure_reaction;
	cloneFrom=allActors;
[AvAffecter] ----------------------------------Cure.
	ID=shana_hatredbeyondmeasure_reaction;
	harmful=false;
	actorValue=cure;
	magnitude=1;
	duration=-2;
--	chance=100 * thisPreviousAVHit:shana_hatredbeyondmeasure_reaction;
	fReq=100 * c:pd_domino + 100 * c:disable + 100 * c:immob + 100 * c:stun + 100 * c:sleep + 100 * c:frozen;
    chance=100;
	FXOnTile=sparkle;
	FXOnHit=chk;
[AvAffecterAoE]
	ID=shana_hatredbeyondmeasure_reaction;
	cloneFrom=oneTile;


[Action] ID=shana_hatredbeyondmeasure_increasehatred;
name=Hatred Beyond Measure;
icon=iconP_Sa_pureMind;
tooltip=Increase hatred stacks.;
harmful=false;
attractAttention=false;
XPCost=70;
maxRank=1;
casterAnimation=charge_alt;
FXOnTarget=largePing;
FXOnTarget=sfx_risingBipLow;
special=usableEvenWhenCantAct;
--special=usableEvenWhenReacting;
special=usableEvenWhenYourTurn;
[ActionAoE]
ID=shana_hatredbeyondmeasure_increasehatred;
cloneFrom=oneTile;
[AvAffecter] ----------------------------------Increase Hatred.
ID=shana_hatredbeyondmeasure_reaction;
actorValue=shana_hatredstacks;
--magnitude=t:shana_hatredstacks + 1;
magnitude=1;
duration=-2;
chance=100;
[AvAffecterAoE]
ID=shana_hatredbeyondmeasure_reaction;
cloneFrom=oneTile;


--the current state is the additional action has been disabled for now.

--issues:

--5) even when the additional action was enabled, it's not making the enemy killable. Once this is fixed then the passive is done!
--consider doing the budget unkillable instead of actual unkillable (hp with duration or something) - see if the value can be t:maxhp * 0.25 or sth
--6) before I forget, once 5 is fixed, set the freq in horizons grave
--todo see if can use actorbool in freq, if it does then can make freq for horizons grave that is "is killable" and give it 9999 aivalue.


--if I make an av that signifies "killable" that really does simplify things doesn't it?

[SupportAbility] ID=shana_Todestrieb; --Note: The boss should have the unkillable bool inherently, this support ability just disables it. Make boss room un-leavable by normal means but no need for extensive anticheese
--Note 2: this only works in combat due to a softlock if it procs out of combat under certain circumstances.
name=Todestrieb;
tooltip=When reaching critical condition for the first time, inflict 10 stacks of Rot<icon=icon_gravekeeper_rot> to all enemies and cure all negative status effects on self, then gain Negate, Aegis and 30<icon=PhysDef> for <icon=time>999. <icon=HP> does not drop below 25% before this occurs, and when it does...;
icon=icon_Gu_mightyBlock; --todo art

[SupportAbilityReaction] --buffs boss defensively but makes it killable when hit into critical, only works when unkillable.
ID=shana_Todestrieb; actorValues=HP; action=shana_todestrieb_reaction;


[ActorValue] ---------------------------------------------------------------this AV is a flag that makes the boss killable
ID=shana_todestriebkillable;
name=Todestrieb Killable (this should not be visible);
icon=;
bubbleIcon=;

defaultValue = 0; AIValue = 0;
harmfulMagnitude = 0;
maximum=1;
affectsActors = true;
canAffectIncapped = false;
showDamageNumbers = true; --to change
showDamageNumbersMagnitude = false;
showDamageNumbersSign = false;
showDamageNumbersIcon = false;
showDamageNumbersElements = false;
showDamageNumbersIconInTooltips = false;
damageNumberColor_Positive = Green;
damageNumberColor_Negative = Green;
actorPaletteOverride =;
actorPaletteOverrideDuration = 0;
elementReactionModifiesDuration = false;
canBeRemovedByNonspecificAVEffectRemoval = false;
recordInActorData = true;
showEvaluationInfo = true; --to change
allowDecimalValues = false;
percentage = false;
XPCostBase = 0;
XPCostIncrement = 0;
XPCostMultiplier = 1;
XPCostFloorToNearest = 0;

[FormulaGlobal] ID=shana_todestrieb_boss_is_unkillable; -- this will be 1 if the boss is unkillable.
formula=1 - c:shana_todestriebkillable;

------------------------------------------Workaround for critical condition returning false if the caster would be dead
[FormulaGlobal] ID=shana_criticalconditioncalcpt1; -- this formula is a workaround as the inbuilt critical condition calc doesn't return true if hp=0.
formula=c:HPMax * 0.25 - c:HP; --maxhp/4 should be strictly more than currenthp

[FormulaGlobal] ID=shana_criticalconditioncalc; -- this formula is a workaround as the inbuilt critical condition calc doesn't return true if hp=0.
formula=moreThan:0:d:shana_criticalconditioncalcpt1; --maxhp/4 should be strictly more than currenthp

--------------------------------------The actual reaction
[Action] ID=shana_todestrieb_reaction;
	name=Todestrieb;
	icon=icon_Gu_mightyBlock;
	tooltip=Todestrieb reaction.;
	harmful=false;
	attractAttention=false;
	XPCost=70;
	maxRank=1;
	special=usableEvenWhenCantAct;
--	special=usableEvenWhenReacting;
	special=usableEvenWhenYourTurn;
[ActionAoE]
	ID=shana_todestrieb_reaction;
	cloneFrom=oneTile;
[AvAffecter] ----------------------------------Dummy AV to play vfx if it goes off.
	ID=shana_todestrieb_reaction;
	harmful=false;
	visibleMiss=false;
	chance=100 * d:shana_todestrieb_boss_is_unkillable * d:shana_criticalconditioncalc;
[AvAffecterAoE]
	ID=shana_todestrieb_reaction;
	cloneFrom=oneTile;

[AvAffecter] ----------------------------------Rot.
	ID=shana_todestrieb_reaction;
	actorValue=ari_rot_status_enemy;
	magnitude=t:ari_rot_status_enemy + 10 * rxn:ruin;
	duration=80;
	chance=100 * d:shana_todestrieb_boss_is_unkillable * d:shana_criticalconditioncalc;
	visibleMiss=false;
	FXOnHitColor=Green;
	FXOnHit=chargeFast_overlap;
	FXOnHitColor=Black;
	FXOnHit=chargeFast_overlap;
	FXOnHitColor=Green;
	FXOnHit=chargeSpiralFast_big;
	FXOnHitColor=Green;
	FXOnHit=chargeSpiralFast_big;
   	FXOnHitColor=Black;
	FXOnHitColor=DarkGreen;
	FXOnHit=downwardLinesQuick;

[AvAffecterAoE]
	ID=shana_todestrieb_reaction;
	shape=7;
	maxRange=100;
	airborne=true;
	arc=true;
	bypassAll=true;
	occupyAll=true;
	canSelectAllies=false;
	canSelectEnemies=true;

[AvAffecter] ----------------------------------Cure.
	ID=shana_todestrieb_reaction;
	harmful=false;
	actorValue=cure;
	magnitude=1;
	duration=-2;
	chance=100 * d:shana_todestrieb_boss_is_unkillable * d:shana_criticalconditioncalc;
	visibleMiss=false;
[AvAffecterAoE]
	ID=shana_todestrieb_reaction;
	cloneFrom=oneTile;
[AvAffecter] -----------------------------------Negate.
	ID=shana_todestrieb_reaction;
	actorValue=negate;
	harmful=false;
	magnitude=1;
	duration=999;
	chance=100 * d:shana_todestrieb_boss_is_unkillable * d:shana_criticalconditioncalc;
	visibleMiss=false;
[AvAffecterAoE]
	ID=shana_todestrieb_reaction;
	cloneFrom=oneTile;

[AvAffecter] -----------------------------------Aegis.
	ID=shana_todestrieb_reaction;
	actorValue=aegis;
	harmful=false;
	magnitude=1;
	duration=999;
	chance=100 * d:shana_todestrieb_boss_is_unkillable * d:shana_criticalconditioncalc;
	visibleMiss=false;
[AvAffecterAoE]
	ID=shana_todestrieb_reaction;
	cloneFrom=oneTile;

[AvAffecter] ------------------------------------30 phys def.
	ID=shana_todestrieb_reaction;
	harmful=false;
	actorValue=PhysDef;
	magnitude=30;
	duration=999;
	chance=100 * d:shana_todestrieb_boss_is_unkillable * d:shana_criticalconditioncalc;
	visibleMiss=false;
[AvAffecterAoE]
	ID=shana_todestrieb_reaction;
	cloneFrom=oneTile;
[AvAffecter] ------------------------------------Set HP back to a quarter of max hp.
	ID=shana_todestrieb_reaction;
	harmful=false;
	visibleEvaluations=false;
	actorValue=HPTrue;
	magnitude=-c:HP + c:HPMax * 0.25;
	duration=-2;
	chance=100 * d:shana_todestrieb_boss_is_unkillable * d:shana_criticalconditioncalc;
	visibleMiss=false;
[AvAffecterAoE]
	ID=shana_todestrieb_reaction;
	cloneFrom=oneTile;
[AvAffecter] ------------------------------------This makes the boss killable once again.
	ID=shana_todestrieb_reaction;
	harmful=false;
	visibleEvaluations=false;
	actorValue=shana_todestriebkillable;
	magnitude=1;
	duration=-2;
	chance=100 * d:shana_todestrieb_boss_is_unkillable * d:shana_criticalconditioncalc;
	visibleMiss=false;
[AvAffecterAoE]
	ID=shana_todestrieb_reaction;
	cloneFrom=oneTile;


-----------------------------------------testing
[ActorClass] name=Testing;
ID=shana_testing;
selectableClass=true;
icon=classIcon_ranger2;
journalID=journal_ranger2;

description=Testing.;
paletteUI=pGreen;

actions=shana_BequeathSelf_enemy;
actions=shana_sleeping_sickness_enemy;
actions=shana_psychenecrosis_enemy;
actions=shana_RottingPus_enemy;
actions=shana_putrefy_vision_enemy;

supportAbilities=shana_festering_fulcrum;
supportAbilities=shana_Todestrieb;
supportAbilities=shana_uber_instability;
supportAbilities=shana_critical_autolyze;
supportAbilities=shana_hatredbeyondmeasure;
relevantStats=TrueHPMax;
